{% include 'settings' %}
{% assign date_format = '%B %d, %Y' %}
{%- assign title = 'shopify.page_titles.search' | t %}

{% if search.performed == false or search.results_count == 0 %}
  {% include 'content-open' class:'column-max padding-top-300 padding-bottom-300' %}
{% else %}
  {% include 'content-open' class:'column-max' %}
{% endif %}


{% comment %} Title {% endcomment %}
{% include 'page-header' title: title, class: 'text-center' %}
{% include 'separator' %}

{% comment %} Search form {% endcomment %}
<div class="column-extra-narrow">
  <form class="search" name="search" action="{{ routes.search_url }}" method="get" role="search">
    <input class="search-text text-center" type="search" name="q" value="{{ search.terms | escape }}" placeholder="{{ 'general.search.input_placeholder' | t }}" autocomplete="off" data-auto-focus>
  </form>
</div>

{% comment %} Results text {% endcomment %}
{% if search.performed == true %}

  {% if search.results_count == 0 %}
    {% render 'separator', class: 'lined margin-top margin-bottom' %}
  {% else %}
    {% render 'separator' %}
  {% endif %}

  <div class="text-center">
    {{ 'general.search.results' | t: count: search.results_count, query: search.terms }}
  </div>

  {% if search.results_count > 0 %}
    {% render 'separator', class: 'lined margin-top margin-bottom' %}
  {% endif %}

{% endif %}

{% comment %} Results {% endcomment %}
{% if search.performed %}
  <div class="search-results column-narrow">
  {% paginate search.results by 30 %}

    {% comment %}paginate search.results by 30{% endcomment %}

    {% comment %} Result {% endcomment %}
    {% for result in search.results %}

      <div class="table search-result search-result-{{ result.object_type }}">

        {% comment %} Image {% endcomment %}
        {% if result.object_type == 'product' %}
          {%- assign result_image = result.featured_media -%}
          {% else %}
          {%- assign result_image = result.image -%}
        {% endif %}

        {% if result_image %}
          {%- assign image_alt = result.title | escape -%}

          <div class="cell image align-top text-center text-left-medium">
            {% include 'image' with result_image, image_alt: image_alt, image_widths: '100, 200, 600', image_link_url: result.url %}
          </div>
        {% endif %}


        {% comment %} Content {% endcomment %}
        <div class="cell content align-top">

          <div class="result-header table">
            
            <div class="cell">
              {% comment %} Title {% endcomment %}
              <a class="result-title text-color font-size-18" href="{{ result.url }}">{{ result.title }}</a>

              {% comment %} URL {% endcomment %}
              <div class="result-url text-light font-size-14">
                {{ result.object_type | capitalize }}
              </div>
            </div>

            {% comment %} Pricing {% endcomment %}
            {% if result.object_type == 'product' %}
              <div class="pricing cell text-right-medium font-size-16">
                {% include 'set-product-vars' product: result, show_price: true, show_from: true, show_compare_at_price: true %}
                {% include 'pricing' %}
              </div>
            {% endif %}

          </div>

          {% comment %} Content {% endcomment %}
          <div class="result-body font-size-14 margin-top-50">
            {% if result.object_type == 'article' and result.published_at %}{{ result.published_at | date: date_format }} &#8212; {% endif %}
            {{ result.content | strip_html | truncatewords: 30 | highlight: search.terms }}
          </div>

          {% comment %} Actions {% endcomment %}
          {% if result.object_type == 'product' %}
            <div class="actions margin-top-50">

              {% comment %}
              Add to cart
                <form action="{{ routes.cart_add_url }}" method="post">
                  <input type="hidden" name="id" value="{{ result.selected_or_first_available_variant.id }}" />

                  <button class="add-to-cart button small" type="submit">{{ 'products.add_to_cart' | t }}</button>
                </form>
              {% endcomment %}

              <a class="button small" href="{{ result.url }}">{{ 'general.search.view_product' | t }}</a>
            </div>
          {% endif %}

        </div>

      </div>

      {% unless forloop.last %}
        {% render 'separator', class: 'lined full margin-top margin-bottom' %}
      {% endunless %}
      
    {% endfor %}

    {% comment %} Pagination {% endcomment %}
    {% include 'pagination' %}
    {% comment %} endpaginate {% endcomment %}
  {% endpaginate %}
  </div>
{% endif %}

{% include 'content-close' %}


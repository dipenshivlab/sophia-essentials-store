<ul>

{% comment %} Level 1 {% endcomment %}

{% for l1_link in menu.links %}

  {%- assign l1_link_class = 'nav-item nav-level-1' -%}
  {% if l1_link.active or l1_link.child_active %}
    {%- assign l1_link_class = l1_link_class | append: ' nav-active' -%}
  {% endif %}
  {% if l1_link.links.size > 0 %}
    {%- assign l1_link_class = l1_link_class | append: ' nav-node' -%}
  {% endif %}

  <li class="{{ l1_link_class }}">
    
    <a href="{{ l1_link.url }}">{{ l1_link.title }}{% if l1_link.links.size > 0 and menu_levels > 1 %}<i class="fa fa-caret-down"></i>{% endif %}</a>
    {% comment %} Level 2 {% endcomment %}

    {% if l1_link.links.size > 0 and menu_levels > 1 %}

    <ul>

    {% for l2_link in l1_link.links %}
      
    {%- assign l2_link_class = 'nav-item nav-level-2' -%}

      {% if l2_link.active or l2_link.child_active %}
        {%- assign l2_link_class = l2_link_class | append: ' nav-active' -%}
      {% endif %}

      {% if l2_link.links.size > 0 %}
        {%- assign l2_link_class = l2_link_class | append: ' nav-node' -%}
      {% endif %}

      <li class="{{ l2_link_class }}">
        <a href="{{ l2_link.url }}">{{ l2_link.title }}{% if l2_link.links.size > 0 and menu_levels > 2 %}<i class="fa fa-caret-down"></i>{% endif %}</a>


        {% comment %} Level 3 {% endcomment %}

        {% if l2_link.links.size > 0 and menu_levels > 2 %}

        <ul>

        {% for l3_link in l2_link.links %}
          {%- assign l3_link_class = 'nav-item nav-level-3' -%}

          {% if l3_link.active or l3_link.child_active %}
            {%- assign l3_link_class = l3_link_class | append: ' nav-active' -%}
          {% endif %}

          <li class="{{ l3_link_class }}">
            <a href="{{ l3_link.url }}">{{ l3_link.title }}</a>
          </li>

        {% endfor %}

        </ul>

        {% endif %}
        {% comment %} End level 3 {% endcomment %}

      </li>

    {% endfor %}

    </ul>

    {% endif %}
    {% comment %} End level 2 {% endcomment %}

  </li>

{% endfor %}


{% comment %} Mobile main menu only {% endcomment %}

{% if menu_id == 'main' %}

  {% capture cart_item_count %}<span class="cart-item-count-items">{{ 'cart.item_count' | t: count: cart.item_count }}</span>{% endcapture %}

  {% capture cart_total_price %}{{ cart.total_price | money  }}{% endcapture %}

  <li class="show-for-small">
  {% include 'separator' class: 'lined no-margin-left margin-top-50 margin-bottom-50 no-padding' %}
  </li>

  <li class="show-for-small">
    <a href="{{ routes.cart_url }}">{{ 'mobile.main_menu.checkout_link_html' | t: cart_item_count: cart_item_count, cart_total_price: cart_total_price }}</a>
  </li>

  <li class="show-for-small">
    <a href="{{ routes.search_url }}" data-toggle-top-bar-search>{{ 'general.search.input_placeholder_short' | t }}</a>
  </li>

  {% if shop.customer_accounts_enabled %}
    {% if customer %}
      <li class="show-for-small">
        <a href="{{ routes.account_url }}">{{ 'general.top_bar.my_account' | t: customer_first_name: customer.first_name }}</a>
      </li>
      <li class="show-for-small">
        {{ 'customer.sign_out' | t | customer_logout_link }}
      </li>
    {% else %}
      <li class="show-for-small">
        {{ 'customer.sign_in' | t | customer_login_link }}
      </li>
    {% endif %}
  {% endif %}
{% endif %}

</ul>

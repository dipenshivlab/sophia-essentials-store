{% include 'settings' %}

{% comment %}
  Section
{% endcomment %}
{% include 'section-open' section_type: 'cart-template', show_title: false %}

{% comment %}
  If the cart has items in it
{% endcomment %}
{% if cart.item_count > 0 %}
  {% include 'page-header' class: 'text-center'%}
  {% include 'separator' class: 'lined margin-top margin-bottom' %}

  <div data-section-id="{{ section.id }}" data-section-type="cart">

    {% comment %}
      Cart form
    {% endcomment %}
    <form class="cart" action="{{ routes.cart_url }}" method="post">

      {% comment %}
        Checkout
      {% endcomment %}
      {% if section.settings.show_checkout_buttons_top %}
        <div class="row checkout text-center text-right-large">
          <div class="small-12 columns">

            <div class="row">
              <div class="small-12 large-6 large-push-3 columns">
                {% comment %}
                  Actions
                {% endcomment %}
                <div class="actions">
                  <input type="submit" name="update" class="button secondary update" value="{{ 'cart.general.update' | t }}">
                  <input type="submit" name="checkout" class="button checkout" value="{{ 'cart.general.checkout' | t }}">
                </div>

                {% comment %}
                  Additional checkout buttons
                {% endcomment %}
                {% if additional_checkout_buttons and section.settings.show_additional_checkout_buttons %}
                <div class="additional-checkout-buttons">
                  {{ content_for_additional_checkout_buttons }}
                </div>
                {% endif %}
              </div>
            </div>

          </div>
        </div>

        {% comment %}
          Separator
        {% endcomment %}
        {% include 'separator' class: 'margin-top margin-bottom' %}
      {% endif %}

      {% comment %}
        Line items
      {% endcomment %}
      <div class="line-items">
      {% for item in cart.items %}

        {% comment %}
          Get the item property size
        {% endcomment %}
        {%- assign property_size = item.properties | size -%}

        {% comment %}
          Set the display style of the line price
        {% endcomment %}
        {% if item.line_level_discount_allocations.size > 0 %}
          {% assign original_price_class = 'price compare-at text-light' %}
        {% else %}
          {% assign original_price_class = 'price' %}
        {% endif %}

        {% comment %}
          Line item
        {% endcomment %}
        <div class="line-item row">

          {% comment %}
            Image
          {% endcomment %}
          <div class="image small-3 medium-2 large-1 columns text-center">
            {% include 'image' with item.image, image_widths: '100, 250, 650', image_link_url: item.url %}
          </div>

          <div class="small-9 medium-10 large-11 columns">
            <div class="row">
              <div class="meta small-12 medium-6 columns text-light">

                {% comment %}
                  Title
                {% endcomment %}
                <div class="product-title font-size-15">
                  <a class="text-color" href="{{ item.url | within: collections.all }}">{{ item.product.title }}</a>
                </div>

                {% comment %}
                  Variant title
                {% endcomment %}
                {% unless item.variant.title contains 'Default' %}
                  <div class="variant-title font-size-13 spacing-top">{{ item.variant.title }}</div>
                {% endunless %}

                {% comment %}
                  Line item properties

                  Line item properties come in two parts. The first part will be passed with the default form, but p.last is the actual custom property and may be blank. If it is, don't show it.

                  For more info on line item properties, visit:
                    - http://docs.shopify.com/support/your-store/products/how-do-I-collect-additional-information-on-the-product-page-Like-for-a-monogram-engraving-or-customization
                {% endcomment %}
                {% if property_size > 0 %}
                  <div class="properties font-size-13 spacing-top">
                    {% for p in item.properties %}
                      {% unless p.last == blank %}
                        <span class="property">
                          <span class="property-title">{{ p.first }}:</span>
                          {% comment %}
                            Check if there was an uploaded file associated
                          {% endcomment %}
                          {% if p.last contains '/uploads/' %}
                            <a href="{{ p.last }}" data-target-new>{{ 'general.forms.file' | t }}</a>
                          {% else %}
                            {{ p.last }}
                          {% endif %}
                        </span>
                      {% endunless %}
                    {% endfor %}
                  </div>
                {% endif %}

                {% comment %}
                  Discounts
                {% endcomment %}
                {% if item.line_level_discount_allocations.size > 0 %}
                  <div class="discounts text-light font-size-12 spacing-top">
                    {% for allocation in item.line_level_discount_allocations %}
                      <div class="discount">
                        <i class="fa fa-tags"></i> {{ allocation.discount_application.title }} (-{% include 'price', amount: allocation.discount_application.total_allocated_amount, class: '' %})</div>
                    {% endfor %}
                  </div>
                {% endif %}
              </div>

              <div class="small-12 medium-5 medium-push-1 columns">
                <div class="row">
                  <div class="qty small-12 large-6 columns">

                    {% comment %}
                      Quantity / update / remove
                    {% endcomment %}
                    <div class="row">
                      <div class="small-4 large-6 columns no-margin-bottom">
                        <label class="hidden" for="updates_{{ item.key }}">{{ 'cart.label.quantity' | t }}</label>
                        <input class="quantity text-center" type="number" name="updates[]" id="updates_{{ item.key }}" value="{{ item.quantity }}" min="0" pattern="[0-9]*">
                      </div>
                      <div class="small-4 columns no-margin-bottom hide-for-large">
                        <button type="submit" name="update" class="button secondary">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 24 24"
                            width="20"
                            height="20"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12"></polyline>
                          </svg>
                        </button>
                      </div>
                      <div class="small-4 large-6 columns no-margin-bottom">
                        <a href="{{ routes.cart_change_url }}?line={{ forloop.index }}&amp;quantity=0" class="button secondary">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 24 24"
                            width="20"
                            height="20"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
                          </svg>
                        </a>
                      </div>
                    </div>
                  </div>

                  <div class="pricing small-12 large-6 columns text-right">

                    {% comment %}
                      Price
                    {% endcomment %}
                    <span class="line-price-calc font-size-12">
                      {{ item.quantity }} x <span>{% include 'price', amount: item.original_price, class: 'price item-price' %}</span>
                    </span>

                    {% include 'price', amount: item.original_line_price, class: original_price_class %}

                    {% if item.line_level_discount_allocations.size > 0 %}
                      {% include 'price', amount: item.final_line_price, class: 'price' %}
                    {% endif %}

                    {%- if item.unit_price_measurement -%}
                      {%- capture unit_price_separator -%}
                        <span class="price per-unit text-light font-size-12" aria-hidden="true">&sol;</span><span class="visually-hidden">{{ 'products.per' | t }}</span>
                      {%- endcapture -%}
                      {%- capture unit_price_base_unit -%}
                        <span class="price per-unit text-light font-size-12">
                          {%- if item.unit_price_measurement.reference_value != 1 -%}
                            {{- item.unit_price_measurement.reference_value -}}
                          {%- endif -%}
                          {{- item.unit_price_measurement.reference_unit -}}
                        </span>
                      {%- endcapture -%}
                      <br/>
                      {%- include 'price', amount: item.unit_price, class: 'price per-unit text-light font-size-12' -%}{{- unit_price_separator -}}{{- unit_price_base_unit -}}
                    {%- endif -%}

                  </div>

                </div>
              </div>
            </div>
          </div>
        </div>

        {% comment %}
          Separator
        {% endcomment %}
        {% include 'separator' class: 'lined full margin-top margin-bottom' %}
      {% endfor %}
      </div>

      {% comment %}
        Separator
      {% endcomment %}
      {% include 'separator' %}

      {% comment %}
        Checkout
      {% endcomment %}
      <div class="row checkout text-center text-right-large">
        <div class="small-12 columns">

          <div class="row">
            <div class="small-12 large-6 columns">
              {% if section.settings.enable_cart_notes %}
                <div class="cart-note">
                  <label for="cart-note" class="cart-note-label text-left-medium">{{ 'cart.general.add_note' | t }}</label>
                  <textarea name="note" id="cart-note" rows="3">{{ cart.note }}</textarea>
                </div>
                {% include 'separator' %}
              {% endif %}
            </div>
            <div class="small-12 large-6 columns">

              {% comment %}
                Discounts
              {% endcomment %}
              {% if cart.cart_level_discount_applications.size > 0 %}

                <div class="subtotal row">
                  <div class="totals-title font-size-13 small-6 columns">
                    <span class="subtotal-title">{{ 'cart.general.subtotal' | t }}</span>
                  </div>
                  <div class="small-6 columns text-right">
                    {% include 'price' amount: cart.original_total_price,  %}
                  </div>
                </div>

                <div class="discounts">
                  {% for discount_application in cart.cart_level_discount_applications %}
                    <div class="row">
                      <div class="totals-title font-size-13 small-6 columns">
                        <span class="discounts-title">{{ 'cart.general.savings' | t }}</span> ({{ discount_application.title }})
                      </div>
                      <div class="small-6 columns text-right">
                        -{% include 'price' amount: discount_application.total_allocated_amount %}
                      </div>
                    </div>
                  {% endfor %}
                </div>

                {% include 'separator' class: 'no-margin-top margin-bottom-50' %}
              {% endif %}

              {% comment %} {% include 'separator' class: 'no-margin-top' %} {% endcomment %}

              {% comment %}
                Total
              {% endcomment %}
              <div class="total row">
                <div class="totals-title font-size-13 small-6 columns">
                  <span class="total-title">{{ 'cart.general.total' | t }}</span>
                </div>
                <div class="small-6 columns text-right">
                  <span class="Bold-theme-hook-DO-NOT-DELETE bold_cart_total" style="display:none !important;"></span>{% include 'price' amount: cart.total_price, class: 'price' %}
                </div>
              </div>

              {% comment %}
                Separator
              {% endcomment %}
              {% include 'separator' class: 'margin-top' %}

              {% comment %}
                Shipping and taxes notice
              {% endcomment %}
              <div class="shipping text-light font-size-13">
                {{ 'cart.general.shipping_at_checkout' | t }}
              </div>

              {% comment %}
                Separator
              {% endcomment %}
              {% include 'separator' %}

              {% comment %}
                Actions
              {% endcomment %}
              <div class="actions">
                <input type="submit" name="update" class="button secondary update" value="{{ 'cart.general.update' | t }}">
                <input type="submit" name="checkout" class="button checkout" value="{{ 'cart.general.checkout' | t }}">
              </div>

              {% comment %}
                Additional checkout buttons
              {% endcomment %}
              {% if additional_checkout_buttons and section.settings.show_additional_checkout_buttons %}
              <div class="additional-checkout-buttons">
                {{ content_for_additional_checkout_buttons }}
              </div>
              {% endif %}

              {% comment %}
                Continue shopping link
              {% endcomment %}
              <div class="continue-shopping text-light font-size-13 margin-top">
                <a href="{{ routes.all_products_collection_url }}">{{ 'cart.general.continue_shopping' | t }}</a>
              </div>

            </div>
          </div>

        </div>
      </div>

    </form>

  </div>

{% comment %}
  If the cart is empty
{% endcomment %}
{% else %}
  <div class="text-center padding-top-200 padding-bottom-200">
    {% include 'page-header' %}
    {% include 'separator' class:'lined margin-top margin-bottom' %}
    {{ 'cart.general.empty_html' | t }}
  </div>
{% endif %}


{% comment %}
  Custom page content
{% endcomment %}
{% if section.settings.cart_page_content != empty %}
  <div class="rte margin-top-250">
    {{ pages[section.settings.cart_page_content].content }}
  </div>
{% endif %}


{% include 'section-close'  %}


{% comment %}
  Schema
{% endcomment %}
{% schema %}
{
  "name": "Cart page",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_additional_checkout_buttons",
      "label": "Show additional checkout buttons"
    },
    {
      "label": "Show checkout buttons at the top as well",
      "id": "show_checkout_buttons_top",
      "type": "checkbox",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_cart_notes",
      "label": "Enable cart notes"
    },
    {
      "type": "page",
      "id": "cart_page_content",
      "label": "Show content from page"
    }
  ]
}
{% endschema %}
